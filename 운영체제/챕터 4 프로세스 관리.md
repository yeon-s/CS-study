# 챕터 4 프로세스 관리

# 프로세스 생성

부모 프로세스가 자식 프로세스 생성(복제 생성)

프로세스 문맥 모두 복사, 부모 프로세스의 주소 공간인 코드 데이터 스택을 복사해서 자식 프로세스 만들고, PC 레지스터도 카피.

프로세스의 트리(계층 구조) 형성

프로세스는 자원을 필요로 한다.( CPU나 메모리, 운영체제로부터 받는다.)

부모와 자식 프로세스는 일반적으로는 자원을 공유하지 않는다.( 프로세스는 독립적이기 때문) 그런데 공유하는 모델도 있다.(유닉스 같은 효율적인 운영체제에서는 처음에 공유하다가 독립적인 일을 수행할 때가 되면 복사 진행 (copy-on-write)  ) 

부모와 자식이 공존하며 수행되는 모델도 있고 자식이 종료될때까지 부모가 기다리는 모델도 있다.

![Untitled](/image/os/chapter4/Untitled.png)

자식은 부모의 주소 공간을 복사함 (운영체제에 있는 데이터들, PCB나 자원들 복사 )

복제한 공간에 새로운 프로그램을 덮어씌운다.

fork()라는 시스템 콜로 복제 ⇒ exec() 시스템 콜을 통해 새로운 프로그램을 덮어씌움.

시스템 콜이기 때문에 사용자 프로세스가 직접 생성하는 것이 아닌 운영체제를 통해서 생성

![Untitled](/image/os/chapter4/Untitled1.png)

# 프로세스 종료

프로세스가 마지막 명령을 수행한 후 운영체제에게 알려줌 ⇒ exit 시스템 콜로 프로세스 종료( 메소드 블록 중괄호 닫게 되면 컴파일러가 exit시스템 콜을 자동으로 넣어줌)

프로세스가 종료 될 때 자식이 부모에게 output 데이터 보낸다.(wait 시스템 콜을 통해)

프로세스의 각종 자원들이 운영체제에게 반납된다.

부모 프로세스가 자식의 수행을 종료시킴⇒abort 시스템 콜을 통해(강제 종료)

- 자식이 할당 자원의 한계치를 넘어섰을 때
- 자식에게 할당된 테스크가 더 이상 필요하지 않을 때
- 부모 프로세스가 종료되는 경우
    - 운영체제는 부모 프로세스가 종료하는 경우 자식이 더 이상 수행되도록 두지 않는다.
    - 리프노드부터 단계적으로 종료된다.

![Untitled](/image/os/chapter4/Untitled2.png)

# fork() 시스템 콜

![Untitled](/image/os/chapter4/Untitled3.png)

부모 프로세스가 fork()하면 자식 프로세스가 생성되고 자식 프로세스는 부모의 PC 레지스터를 복사했기 때문에 fork() 이후부터 명령을 수행한다.

부모 프로세스와 자식프로세스의 fork() 리턴값이 다르다.

자식은 0을 리턴, 부모는 자식의 프로세스 id(양수)를 리턴한다.

# exec() 시스템 콜

어떤 프로그램을 완전히 새로운 프로세스로 태어나게 해주는 역할

자식 프로세스는 처음 fork()로 복제되어서 main함수와 같은 코드를 가지고 있다. 그래서 hello im children을 출력하고 execlp함수로 bin/date함수로 바뀌게 된다. 

![Untitled](/image/os/chapter4/Untitled4.png)

# wait() 시스템 콜

프로세스를 block 상태로 만든다.

보통 자식 프로세스를 만들고 wait() 시스템콜을 하게 된다. 

자식 프로세스가 종료되기를 기다리면서 block 상태가 된다. 자식 프로세스가 종료되면 부모 프로세스가 block에서 ready 상태로 바뀐다.

![Untitled](/image/os/chapter4/Untitled5.png)

# exit() 시스템 콜

프로세스를 종료시킬 때 호출하는 시스템 콜

![Untitled](/image/os/chapter4/Untitled6.png)

# 프로세스 간 협력

원칙적으로 프로세스는 독립적이다. 하나의 프로세스가 다른 프로세스의 수행에 영향을 미치지 못한다. 경우에 따라서 프로세스들이 협력해야지만 효율적일 때가 있다.

- 독립적 프로세스
    - 프로세스는 각자의 주소 공간을 가지고 수행되므로 원칙적으로 하나의 프로세스는 다른 프로세스의 수행에 영향을 미치지 못한다.
- 협력 프로세스
    - 프로세스 협력 메커니즘을 통해 하나의 프로세스가 다른 프로세스의 수행에 영향을 미칠 수 있음

프로세스간 서로 정보를 주고 받는 협력 메커니즘 존재한다. IPC라고 부른다. 

IPC에는 두가지 방법이 있다.

- 메시지 공유 방식
    - 커널을 통해 메시지 전달한다.
    - 통신하려는 프로세스의 이름을 명시하느냐 안하느냐에 따라서 직접 통신하는 방법과 간접 통신하는 방법으로 나뉜다.
- 공뮤 메모리 방식
    - 서로 다른 프로세스 간에도 일부 주소 공간을 공유하게 한다.
    - 공유 메모리를 사용하려면 커널한테 공유 메모리를 쓴다는 시스템 콜을 해서 매핑 해놓고 그때부터 공유

![Untitled](/image/os/chapter4/Untitled7.png)

![Untitled](/image/os/chapter4/Untitled8.png)

![Untitled](/image/os/chapter4/Untitled9.png)
