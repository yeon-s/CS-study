# 도커

[Docker로 구축](https://www.notion.so/Docker-b2cb169713134e0ca330a1caf2c52256)

[수동배포](https://www.notion.so/3443fe502aa14f858d72afd1c7b4455b)

도커와 같은 컨테이너 기술은 리눅스 운영체제 기술이다.

윈도우나 맥이라도 가상머신을 설치하고 가상머신안에 리눅스 운영체제를 깔면 리눅스 운영체제 안에서 도커와 같은 컨테이너 기술을 사용할 수 있다.

도커가 알아서 가상머신을 만들어주고 그 위에 리눅스를 설치해준다. 하지만 가상머신을 설치하기 때문에 속도 저하가 있다. 그럼에도 불구하고 도커를 쓰는 이유는 편의성이 어마어마하기 때문이다.

### 도커와 가상머신 비교

가상 머신은 한 물리적 컴퓨터 안에 각각 OS를 가동하는 가상 컴퓨터들이 물리적 자원을 분할해서 쓰기 때문에 성능에 한계가 있다. 도커는 실행환경만 독립적으로 돌리는 거라서 가상 컴퓨팅보다 훨씬 가볍고 빠르게 구동할 수 있다. 

![Untitled](/image/Docker/Untitled.png)

![Untitled](/image/Docker/Untitled%201.png)

### 도커 장점

서버를 관리하고 서비스들을 배포하는 일이 편리하다.

깃으로 프로젝트를 받으면 환경설정이나 설치, 라이브러리 추가 없이 사용할 수 있다.

### 프로그램과 도커 비교

![Untitled](/image/Docker/Untitled%202.png)

프로그램이 여러 개의 프로세스를 가질 수 있는 것처럼 이미지도 여러 개의 컨테이너를 가질 수 있다.

도커 허브에서 이미지를 다운 받는 행위를 풀이라고 한다. 이미지를 실행시키는 행위를 런이라고 한다.   

![Untitled](/image/Docker/Untitled%203.png)

호스트 안에는 여러 컨테이너가 있을 수 있기 때문에 호스트의 포트와 컨테이너의 포트를 연결해줘야한다.

![Untitled](/image/Docker/Untitled%204.png)

 접속경로가 8000포트로 변경된다면

컨테이너 내의 프로세스를 수정하고 싶다면

docker exec 명령어로 가능

터미널과 컨테이너 지속적으로 유지하고 싶다면  docker exec -it

### 도커 파일을 만들어서 이미지를 만드는 빌드명령의 사용법

**2가지 방법**

1. 커밋 명령으로 현재 컨테이너를 이미지로 만드는 방법
2. 도커파일을 작성 
- 우리가 만들고 싶은 이미지에 대해서 도커 파일의 형식에 맞게 적고 빌드 명령을 내리면 도커파일을 바탕으로 새로운 이미지를 만든다.

**커밋과 빌드의 차이**

이미 사용하고 있는 컨테이너가 있을 때 그 컨테이너를 이미지로 만드는 백업과 같은 느낌

빌드는 도커파일을 통해 만들고 싶은 이미지를 구체적으로 시간의 순서에 따라 기록해서 만드는 생성하는 느낌

### 도커 파일

나만의 이미지를 만들기 위한 설계도

##이 버전의 우분투 이미지에 덧붙여서(공식 이미지를 개조,튜닝)

FROM ubuntu:20.04 

##이미지를 생성하는 과정에서 실행할 명령어

RUN apt update && apt install -y python3 

(&&역할: 앞에있는 명령어 실행되고 뒤에 명령어 실행,   -y: 명령어로 하게 되면 정말 설치할거냐고 묻는데 도커파일은 그게 뜨면 실행이 안됨 그래서 미리 예스 옵션을 주는것)

##이미지 내에서 명령어를 실행할 디렉토리 설정

WORKDIR /var/www/html (디렉토리가 없다면 만들고 사용자를 그 디렉토리로 이동하고 뒤에 명령어들(도커 파일내의 명령어)이 이 디렉토리를 대상으로 명령이 실행되게 된다.

##도커환경에서 컨테이너 생성시 스크립트를 실행하는 폴더로 미리 작성된 스크립트들을 이동

COPY [”index.html”, “.”] (호스트에 있는 intdex.html을 WORKDIR 뒤에 디렉토리에 복사하라는 뜻)

##컨테이너 실행시 실행할 명령어

CMD [”python3”, “-u”, “-m”, “http.server”]  

**RUN과 CMD 차이**

런은 빌드가 되는 시점에 실행되는 명령어 ⇒ 이미지에 반영 (이미지를 생성하는 과정에서 실행되는 것)

CMD는 컨테이너가 실행될 때 실행되는 명령어 ⇒ 컨테이너에 반영 (이미지로부터 컨테이너가 만들어져 가동될 떄 바로 실행되는 명령어)

**copy와 volume의 차이**

copy는 run처럼 이미지를 생성하는 과정에서 해당 이미지 안에 특정 파일을 미리 넣어두는 것.

volume은 cmd처럼 컨테이너가 생성되어 실행될때 그 내부의 폴더를 외부의 것과 연결하는 것.

### 도커 컴포즈

매번 백엔드,프론트,디비를 이미지로 만들어 컨테이너로 실행시키기 번거롭다. 한번에 연결된 모듈처럼 사용하게 하기 위함. 

![스크린샷 2023-03-19 오후 10.08.07.png](/image/Docker/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-03-19_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_10.08.07.png)

docker-compse.yml을 만들고 콘솔에서 docker-compose up 명령어를 치면 컨테이너가 만들어진다.
